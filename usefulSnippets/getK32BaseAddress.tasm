getK32BaseAddress:
; stolen from https://rootfu.in/how-to-part-1-find-dllbase-address-from-peb-in-x64-assembly/, https://web.archive.org/web/20250901195517/https://rootfu.in/how-to-part-1-find-dllbase-address-from-peb-in-x64-assembly/
; then translated from proper x64 asm to tasm64
push rsi
push rbx

tebfinder
; rax = PEB*
mov rsi rax
; rsi = PEB*

mov rbx 0x18
add rax rbx
; rax = &(PEB->Ldr)

mov* rax rax
; rax = PEB->Ldr

mov rbx 0x20
add rax rbx
mov* rsi rax
; rsi = PEB->Ldr->InMemoryOrderModuleList

lodsq
xchg rax rsi
lodsq
mov rbx 0x20
add rax rbx
mov* rax rax

pop rbx
pop rsi
ret
